# 你不知道的JS

## 作用域是什么？
- - -
### 编译原理
尽管通常将 JavaScript 归类为“动态”或“解释执行”语言，但事实上它是一门编译语言。
与传统的编译语言不同，它不是提前编译的，编译结果也不能在分布式系统中进行移植。
在传统编译语言的流程中，程序中的一段源代码在执行之前会经历三个步骤，统称为“编译”

+ 分词/词法分析 （Tokenizing/Lexing）
  ```
  这个过程会将“由字符组成的字符串分解成代码块”，例如 "var a = 10;" 这行代码通常会被分解成为"var、a、=、2、;" 分解为这种 操作符、
  变量名、运算符、值、分号 或者 变量名、运算符、值、分号
  ```
+ 解析/语法分析 （parsing）
  ```
  这个过程是将词法单元流（数组）转换成一个程序语法树。这个树被称为”抽象语法树“。
  再 "var a = 10;"的抽象语法树中可能会有一个叫做 VariableDeclaration 的顶级节点，然后是 Identifier（值是 a）的子节点，以及一个叫做 AssignmentExpression 的子节点。
  AssignmentExpression 节点有一个叫做 NumericaLiteral（值为 10）的子节点。
  ```
+ 代码生成
  ```
  将 AST 转换为可执行代码的过程称为代码生成。简单来说就是有某种方法将 "var a = 10;"的 AST 转化为一组机器指令，用来创建一个叫做 a 的变量（包括分配内存等），并将一个值储存在 a 中。
  ```
  
但是 JavaScript 引擎要复杂更多。例如，在语法分析和代码生成阶段有特定的步骤来对运行性能进行优化，包括对冗余元素进行优化等。
JavaScript 引擎不会有大量的（像其他语言编译器那么多的）时间用来进行优化，因为与其他语言不同，JavaScript 的编译过程不是发生在构建之前的。
对于 JavaScript 来说，大部分情况下编译发生在代码执行前的几微秒（甚至更短！）的时间内。在我们所要讨论的作用域背后，JavaScript 引擎用尽了各种
办法（比如 JIT，可以延迟编译甚至实施重编译）来保证性能最佳。

简单地说，任何 JavaScript 代码片段在执行前都要进行编译（通常就在执行前）。因此，
JavaScript 编译器首先会对 var a = 2; 这段程序进行编译，然后做好执行它的准备，并且
通常马上就会执行它。

#### 要参与到对程序 var a = 10; 进行处理的过程中的成员。
+ 引擎
  从头到尾负责整个 JavaScript 程序的编译及执行过程。
+ 编译器
  引擎的好朋友之一，负责语法分析及代码生成等脏活累活。
+ 作用域
  引擎的另一位好朋友，负责收集并维护由所有声明的标识符（变量）组成的一系列查询，并实施一套非常严格的规则，确定当前执行的代码对这些标识符的访问权限。
